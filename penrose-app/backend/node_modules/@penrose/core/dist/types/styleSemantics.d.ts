import im from "immutable";
import { ShapeType } from "../shapes/Shapes.js";
import Graph from "../utils/Graph.js";
import * as ad from "./ad.js";
import { A, C, Identifier } from "./ast.js";
import { StyleDiagnostics, StyleError } from "./errors.js";
import { Fn } from "./state.js";
import { BindingForm, Expr, GPIDecl, Header, StyT } from "./style.js";
import { ArgVal, Field, Name, PropID } from "./value.js";
export type ProgType = SubProgT | StyProgT;
export interface SubProgT {
    tag: "SubProgT";
}
export interface StyProgT {
    tag: "StyProgT";
}
export interface SelEnv {
    sTypeVarMap: {
        [k: string]: StyT<A>;
    };
    varProgTypeMap: {
        [k: string]: [ProgType, BindingForm<A>];
    };
    skipBlock: boolean;
    header: Header<A> | undefined;
    warnings: StyleError[];
    errors: StyleError[];
}
export type Subst = {
    [k: string]: string;
};
export type StySubSubst = {
    tag: "StySubSubst";
    contents: Subst;
};
export type CollectionSubst = {
    tag: "CollectionSubst";
    groupby: Subst;
    collName: string;
    collContent: string[];
};
export type StySubst = StySubSubst | CollectionSubst;
export type LocalVarSubst = LocalVarId | NamespaceId;
export interface LocalVarId {
    tag: "LocalVarId";
    contents: [number, number];
}
export interface NamespaceId {
    tag: "NamespaceId";
    contents: string;
}
export type StyleName = Name;
export type SubstanceName = Name;
export interface WithContext<T> {
    context: Context;
    expr: T;
}
export type NotShape = Exclude<Expr<C>, GPIDecl<C>>;
export interface ShapeSource {
    tag: "ShapeSource";
    shapeType: ShapeType;
    props: im.Map<PropID, WithContext<NotShape>>;
}
export interface OtherSource {
    tag: "OtherSource";
    expr: WithContext<NotShape>;
}
export type FieldSource = ShapeSource | OtherSource;
export type FieldDict = im.Map<Field, FieldSource>;
export interface Assignment {
    diagnostics: StyleDiagnostics;
    globals: im.Map<StyleName, FieldDict>;
    unnamed: im.Map<im.List<number>, FieldDict>;
    substances: im.Map<SubstanceName, FieldDict>;
}
export interface Locals {
    locals: im.Map<StyleName, FieldSource>;
}
export interface BlockAssignment extends Assignment, Locals {
}
export interface BlockInfo {
    block: LocalVarSubst;
    subst: StySubst;
}
export interface Context extends BlockInfo, Locals {
}
export interface ResolvedName {
    tag: "Global" | "Local" | "Substance";
    block: LocalVarSubst;
    name: string;
}
export type ResolvedPath<T> = T & ResolvedName & {
    members: Identifier<T>[];
};
export type DepGraph = Graph<string, ShapeType | WithContext<NotShape> | undefined>;
export interface Layer {
    below: string;
    above: string;
}
export interface Translation {
    diagnostics: StyleDiagnostics;
    symbols: im.Map<string, ArgVal<ad.Num>>;
    objectives: im.List<Fn>;
    constraints: im.List<Fn>;
    layering: im.List<Layer>;
}
//# sourceMappingURL=styleSemantics.d.ts.map